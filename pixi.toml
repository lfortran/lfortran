[project]
name = "lfortran"
version = "0.1.0"
description = "Modern interactive LLVM-based Fortran compiler"
authors = ["LFortran Maintainers <lfortran@groups.io>"]
channels = ["https://fast.prefix.dev/conda-forge"]
platforms = ["osx-arm64", "win-64", "linux-64"]

[tasks]
start = "./build/src/bin/lfortran"
test = "cmake --build . --parallel --target test && pytest -v"

[feature.host.dependencies]
llvmdev = "11.*"
toml = "*"
pytest = "*"
jupyter = "*"
xeus = "5.1.0"
xeus-zmq = "3.0.0"
nlohmann_json = "*"
jupyter_kernel_test = "*"
xonsh = "0.16.0"
numpy = "*"
rapidjson = "*"
zlib = "*"

[feature.host.tasks]
# an empty task to make sure the dependencies are installed
setup = "echo 'host dependencies installed'"

[feature.build.dependencies]
python = "*"
cmake = "*"
ninja = "*"
cxx-compiler = "*"
re2c = "*"

[feature.build.target.unix.dependencies]
bison = "3.4"

[feature.build.target.win.dependencies]
m2-bison = "3.0.4"

[feature.build.tasks]
build1 = { cmd = "bash ./build1.sh", env = { CMAKE_PREFIX_PATH_LFORTRAN = "$PIXI_PROJECT_ROOT/.pixi/envs/host/" }, depends-on = ["setup"]}
build0 = { cmd = "bash ./build0.sh" }

[environments]
build = ["build"]
host = ["host"]